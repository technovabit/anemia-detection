<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Curriculum & Attendance ‚Äî Student</title>
<style>
  /* Base styles + Animated gradient background */

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(-45deg, #1e3a8a, #3b82f6, #1e3a8a, #3b82f6);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    min-height: 100vh;
    color: #222;
    line-height: 1.6;
    overflow-x: hidden;
  }

  @keyframes gradientBG {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  header {
    background: rgba(30, 58, 138, 0.85);
    color: #fff;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    animation: slideDownFade 1s ease forwards;
  }

  @keyframes slideDownFade {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  header h1 {
    font-size: 1.6rem;
    font-weight: 700;
  }

  section {
    max-width: 900px;
    background: #fff;
    margin: 2rem auto;
    padding: 2rem 2rem 3rem 2rem;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    text-align: center;
    display: none;
    animation: fadeInUp 0.8s ease forwards;
    opacity: 0;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(25px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  h2 {
    text-align: center;
    margin-bottom: 28px;
    color: #1e3a8a;
    font-weight: 700;
    text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.7);
  }

  .card {
    background: #fff;
    padding: 18px 20px;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(59, 130, 246, 0.15);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 16px 45px rgba(59, 130, 246, 0.3);
    transform: translateY(-8px);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    font-size: 0.95rem;
  }

  th,
  td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    text-align: left;
    vertical-align: middle;
  }

  th {
    background: #3b82f6;
    color: white;
    font-weight: 700;
  }

  tbody tr:hover {
    background: #f1f5f9;
  }

  input {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #bbb;
    width: 100%;
    margin-bottom: 1.2rem;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }

  input:focus {
    border-color: #3b82f6;
    outline: none;
  }

  .btn {
    background: #ffd700;
    color: #000;
    padding: 0.75rem 1.3rem;
    border: none;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 8px 15px rgba(255, 215, 0, 0.55);
    transition: background-color 0.3s ease, box-shadow 0.35s ease, transform 0.2s ease;
    max-width: 320px;
    margin: 1rem auto;
    display: block;
  }

  .btn:hover {
    background: #facc15;
    box-shadow: 0 12px 28px rgba(250, 204, 21, 0.85);
    transform: scale(1.08);
  }

  .btn:active {
    transform: scale(0.95);
  }

  .login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: calc(100vh - 64px);
  }

  .login-box {
    background: #fff;
    padding: 3rem 3rem 3rem 3rem;
    border-radius: 16px;
    box-shadow: 0 14px 45px rgba(0, 0, 0, 0.35);
    max-width: 420px;
    width: 90%;
    text-align: center;
    animation: popUp 0.6s ease forwards;
  }

  @keyframes popUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  footer {
    padding: 2rem 1rem;
    text-align: center;
    color:#eee;
    font-weight: 600;
    letter-spacing: 0.05em;
    background: rgba(30, 41, 59, 0.9);
    box-shadow: inset 0 1px 0 rgb(255 255 255 / 0.1);
    margin-top: 2rem;
  }

  /* Profile photo styling */
  #profilePhoto {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #3b82f6;
    margin: 0 auto 1.5rem auto;
    box-shadow: 0 0 20px #3b82f6aa;
    animation: pulseGlow 3s ease-in-out infinite;
  }

  @keyframes pulseGlow {
    0%, 100% {
      box-shadow: 0 0 15px #3b82f6aa;
    }
    50% {
      box-shadow: 0 0 28px #3b82f6dd;
    }
  }

  /* Useful links section styling */
  #usefulLinks ul {
    list-style:none;
    padding-left:0;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  #usefulLinks ul li {
    background: #3b82f6;
    color: white;
    padding: 1rem 1.4rem;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(59,130,246,0.3);
    cursor: pointer;
    flex: 1 1 160px;
    font-weight: 600;
    text-align: center;
    transition: background-color 0.3s ease;
  }
  #usefulLinks ul li:hover {
    background: #2563eb;
  }

  /* Announcements / Notices */
  #notices ul {
    list-style: disc inside;
    max-width: 600px;
    margin: 0 auto;
    color: #555;
    font-size: 1rem;
  }
</style>
</head>
<body>

<header><h1>Smart Curriculum & Attendance</h1>
  <button class="btn" id="studentLogoutBtn" style="float:right;margin-top:-8px;display:none;">Logout</button>
</header>

<!-- Login Page -->
<div class="login-container" id="loginPage">
  <div class="login-box">
    <h2>Student Login</h2>
    <input id="loginUser" type="text" placeholder="Username" autocomplete="username" />
    <input id="loginPass" type="password" placeholder="Password" autocomplete="current-password" />
    <button class="btn" id="loginBtn">Login</button>
    <p style="color:#555;margin-top:12px;font-size:0.9rem;">Ask your faculty for credentials</p>
  </div>
</div>

<!-- Profile Info with photo and name -->
<section id="profile" style="display:none;">
  <img id="profilePhoto" src="" alt="Your Profile Photo" />
  <h2>Welcome, <span id="studentNameDisplay"></span></h2>
</section>

<section id="timetable">
  <h2>Your Timetable</h2>
  <div class="card" id="tt-card"></div>
</section>

<section id="attendance">
  <h2>Your Attendance</h2>
  <div class="card">
    <canvas id="attChart"></canvas>
    <table id="attTable" style="margin-top:20px">
      <thead><tr><th>Date</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<section id="activities">
  <h2>Your Activities</h2>
  <div class="card">
    <ul id="activities-list"></ul>
  </div>
</section>

<section id="notices">
  <h2>Latest Announcements</h2>
  <div class="card">
    <ul id="studentAnnouncementsList"></ul>
  </div>
</section>

<section id="usefulLinks">
  <h2>Quick Links</h2>
  <ul id="studentQuickLinks"></ul>
</section>

<section id="qrScan" style="display:none;">
  <h2>Scan QR Code for Attendance</h2>
  <div class="card">
    <button class="btn" id="startQrScanBtn">Start QR Scan</button>
    <div id="qr-reader" style="margin-top:2rem;"></div>
    <div id="qrScanStatus" style="margin-top:1rem;font-weight:bold;color:#ef4444;"></div>
  </div>
</section>

<section id="changePassword" style="display:none;max-width:400px;margin:2rem auto;">
  <h2>Change Password</h2>
  <div class="card">
    <input type="password" id="oldPass" placeholder="Current Password" />
    <input type="password" id="newPass" placeholder="New Password" />
    <input type="password" id="confirmPass" placeholder="Confirm New Password" />
    <button class="btn" id="changePassBtn">Change Password</button>
    <div id="changePassStatus" style="margin-top:1rem;color:#ef4444;font-weight:bold;"></div>
  </div>
</section>

<section id="contact">
  <h2>Contact Us</h2>
  <p style="text-align:center;color:#1e3a8a;font-weight:600;">
    üìß <a href="mailto:team@smartapp.com" style="color:#1e3a8a;text-decoration:none;">team@smartapp.com</a> | ‚òéÔ∏è +91 98765 43210
  </p>
</section>

<footer>¬© 2025 Smart Curriculum & Attendance App</footer>

<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
<script>
  let currentStudent = null;

  // Demo storage default
  if (!localStorage.getItem('students')) {
    localStorage.setItem(
      'students',
      JSON.stringify([
        {
          name: 'Demo Student',
          username: 'student',
          password: 'student',
          photo:
            'https://randomuser.me/api/portraits/lego/1.jpg',
        },
      ])
    );
  }
  if (!localStorage.getItem('timetableData')) {
    localStorage.setItem(
      'timetableData',
      JSON.stringify([
        { period: 1, subject: 'Mathematics', start: '09:00', end: '09:45' },
        { period: 2, subject: 'Science', start: '09:50', end: '10:35' },
        { period: 3, subject: 'English', start: '10:40', end: '11:25' },
        { period: 4, subject: 'History', start: '11:30', end: '12:15' },
      ])
    );
  }
  if (!localStorage.getItem('activities')) {
    localStorage.setItem(
      'activities',
      JSON.stringify([
        { name: 'Math Quiz', date: '2025-09-20' },
        { name: 'Science Project', date: '2025-09-21' },
      ])
    );
  }
  if (!localStorage.getItem('attendanceRecords')) {
    localStorage.setItem('attendanceRecords', JSON.stringify({}));
  }

  document.getElementById('loginBtn').addEventListener('click', () => {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    const found = students.find(s => s.username === user && s.password === pass);
    if (!found) {
      alert('Invalid username or password');
      return;
    }
    currentStudent = found;
    document.getElementById('loginPage').style.display = 'none';
    showSections();
    renderDashboard();
    document.getElementById('studentLogoutBtn').style.display = 'inline-block';
  });

  document.getElementById('studentLogoutBtn').addEventListener('click', () => {
    currentStudent = null;
    document.querySelectorAll('section').forEach(s => s.style.display = 'none');
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('loginUser').value = '';
    document.getElementById('loginPass').value = '';
    document.getElementById('studentLogoutBtn').style.display = 'none';
  });

  function showSections() {
    document.getElementById('profile').style.display = 'block';
    document.querySelectorAll('section').forEach(section => {
      if (section.id !== 'profile') section.style.display = 'block';
    });
  }

  function renderDashboard() {
    document.getElementById('profilePhoto').src = currentStudent.photo || '';
    document.getElementById('studentNameDisplay').textContent = currentStudent.name || 'Student';
    renderTimetable();
    renderActivities();
    renderAttendance();
    renderStudentAnnouncementsList();
    renderStudentQuickLinks();
  }

  function renderStudentQuickLinks() {
    const ul = document.getElementById('studentQuickLinks');
    ul.innerHTML = '';
    let quickLinks = JSON.parse(localStorage.getItem('quickLinks') || '[]');
    if (quickLinks.length === 0) {
      ul.innerHTML = '<li>No quick links yet.</li>';
      return;
    }
    quickLinks.forEach(link => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="${link.url}" target="_blank" style="color:#fff;text-decoration:none;">${link.text}</a>`;
      ul.appendChild(li);
    });
    // Always add QR scan option
    const qrLi = document.createElement('li');
    qrLi.textContent = 'Scan QR for Attendance';
    qrLi.style.background = '#3b82f6';
    qrLi.style.color = '#fff';
    qrLi.style.cursor = 'pointer';
    qrLi.style.borderRadius = '10px';
    qrLi.style.padding = '1rem 1.4rem';
    qrLi.style.marginTop = '0.5rem';
    qrLi.onclick = showQrScan;
    ul.appendChild(qrLi);
  }

  function renderStudentAnnouncementsList() {
    const ul = document.getElementById('studentAnnouncementsList');
    ul.innerHTML = '';
    let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
    if (announcements.length === 0) {
      ul.innerHTML = '<li>No announcements yet.</li>';
      return;
    }
    announcements.forEach(a => {
      const li = document.createElement('li');
      li.textContent = a;
      ul.appendChild(li);
    });
  }

  function renderTimetable() {
    const data = JSON.parse(localStorage.getItem('timetableData') || '[]');
    let html = `<table>
      <thead><tr><th>Period</th><th>Subject</th><th>Start</th><th>End</th></tr></thead><tbody>`;
    data.forEach(row => {
      html += `<tr>
          <td>${row.period}</td>
          <td>${row.subject}</td>
          <td>${row.start}</td>
          <td>${row.end}</td>
        </tr>`;
    });
    html += '</tbody></table>';
    document.getElementById('tt-card').innerHTML = html;
  }

  function renderActivities() {
    const activities = JSON.parse(localStorage.getItem('activities') || '[]');
    const ul = document.getElementById('activities-list');
    ul.innerHTML = '';
    if (activities.length === 0) {
      ul.innerHTML = '<li>No activities assigned yet</li>';
      return;
    }
    activities.forEach(act => {
      const li = document.createElement('li');
      li.textContent = act.date ? `${act.name} (${act.date})` : act.name;
      ul.appendChild(li);
    });
  }

  function renderAttendance() {
    const records = JSON.parse(localStorage.getItem('attendanceRecords') || '{}');
    const canvas = document.getElementById('attChart');
    const ctx = canvas.getContext('2d');
    const dates = Object.keys(records)
      .filter(d => currentStudent && records[d][currentStudent.username] !== undefined)
      .sort();

    const values = dates.map(d => (records[d][currentStudent.username] === 'Present' ? 1 : 0));

    canvas.width = canvas.clientWidth;
    canvas.height = 200;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const padding = 40;
    const barWidth = (canvas.width - 2 * padding) / dates.length;

    values.forEach((val, i) => {
      const barHeight = val * (canvas.height - 2 * padding);
      const x = padding + i * barWidth + barWidth * 0.1;
      const y = canvas.height - padding - barHeight;

      ctx.fillStyle = val ? 'rgba(59, 130, 246, 0.9)' : '#ddd';
      ctx.fillRect(x, y, barWidth * 0.8, barHeight);

      ctx.fillStyle = '#333';
      ctx.font = '12px "Segoe UI", Tahoma, Geneva, Verdana, sans-serif';
      ctx.fillText(dates[i], x, canvas.height - 15);
    });

    const tbody = document.querySelector('#attTable tbody');
    tbody.innerHTML = '';
    dates.forEach(date => {
      const status = records[date][currentStudent.username] || 'Absent';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${date}</td><td>${status}</td>`;
      tbody.appendChild(tr);
    });
  }

  function showQrScan() {
  // Hide all sections except QR scan
  document.querySelectorAll('section').forEach(s => s.style.display = 'none');
  document.getElementById('qrScan').style.display = 'block';
  document.getElementById('qrScanStatus').textContent = '';
  // Always clear and stop previous scan
  if (window.qrReaderInstance) {
    window.qrReaderInstance.stop().catch(()=>{});
    window.qrReaderInstance = null;
  }
  const qrReaderDiv = document.getElementById('qr-reader');
  qrReaderDiv.innerHTML = '';
  qrReaderDiv.style.display = 'block';
  qrReaderDiv.style.visibility = 'visible';
  setTimeout(() => {
    qrReaderDiv.scrollIntoView({behavior:'smooth', block:'center'});
  }, 200);
// Removed stray closing brace
  }
  document.getElementById('startQrScanBtn')?.addEventListener('click', () => {
    // Always clear and stop previous scan
    const qrReaderDiv = document.getElementById('qr-reader');
    if (window.qrReaderInstance) {
      window.qrReaderInstance.stop().catch(()=>{});
      window.qrReaderInstance = null;
    }
    qrReaderDiv.innerHTML = '';
    qrReaderDiv.style.display = 'block';
    qrReaderDiv.style.visibility = 'visible';
    setTimeout(() => {
      qrReaderDiv.scrollIntoView({behavior:'smooth', block:'center'});
    }, 200);
    // Always request rear camera (environment)
    navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
      .then(stream => {
        stream.getTracks().forEach(track => track.stop()); // release camera for html5-qrcode
        setTimeout(() => {
          try {
            const qrReader = new Html5Qrcode('qr-reader');
            window.qrReaderInstance = qrReader;
            qrReader.start({ facingMode: "environment" }, {
              fps: 10,
              qrbox: 250
            }, qrCodeMessage => {
              try {
                const data = JSON.parse(qrCodeMessage);
                const now = Date.now();
                if (now > data.expires) {
                  document.getElementById('qrScanStatus').textContent = 'QR code expired.';
                  qrReader.stop();
                  window.qrReaderInstance = null;
                  return;
                }
                // Mark attendance for this period and date
                const records = JSON.parse(localStorage.getItem('attendanceRecords') || '{}');
                if (!records[data.date]) records[data.date] = {};
                records[data.date][currentStudent.username] = 'Present';
                localStorage.setItem('attendanceRecords', JSON.stringify(records));
                document.getElementById('qrScanStatus').textContent = 'Attendance marked Present!';
                qrReader.stop();
                window.qrReaderInstance = null;
                renderAttendance();
              } catch (e) {
                document.getElementById('qrScanStatus').textContent = 'Invalid QR code.';
                qrReader.stop();
                window.qrReaderInstance = null;
              }
            }, errorMsg => {
              if (errorMsg && errorMsg.toLowerCase().includes('permission')) {
                document.getElementById('qrScanStatus').textContent = 'Camera permission denied. Please allow camera access.';
              } else {
                document.getElementById('qrScanStatus').textContent = 'Camera error: ' + errorMsg;
              }
            });
          } catch (err) {
            document.getElementById('qrScanStatus').textContent = 'Unable to initialize camera. Please check camera connection and permissions.';
          }
        }, 200);
      })
      .catch(err => {
        if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
          document.getElementById('qrScanStatus').textContent = 'Camera permission denied. Please allow camera access.';
        } else if (err.name === 'OverconstrainedError' || err.name === 'ConstraintNotSatisfiedError') {
          document.getElementById('qrScanStatus').textContent = 'Rear camera not found. Please check your device or use a different one.';
        } else {
          document.getElementById('qrScanStatus').textContent = 'Unable to access camera. Please check permissions or try a different device.';
        }
      });
  });

  function showChangePassword() {
    document.getElementById('changePassword').style.display = 'block';
    document.getElementById('changePassStatus').textContent = '';
    document.getElementById('oldPass').value = '';
    document.getElementById('newPass').value = '';
    document.getElementById('confirmPass').value = '';
  }
  document.getElementById('changePassBtn').addEventListener('click', () => {
    const oldPass = document.getElementById('oldPass').value.trim();
    const newPass = document.getElementById('newPass').value.trim();
    const confirmPass = document.getElementById('confirmPass').value.trim();
    if (!oldPass || !newPass || !confirmPass) {
      document.getElementById('changePassStatus').textContent = 'Please fill all fields.';
      return;
    }
    if (newPass !== confirmPass) {
      document.getElementById('changePassStatus').textContent = 'New passwords do not match.';
      return;
    }
    if (currentStudent.password !== oldPass) {
      document.getElementById('changePassStatus').textContent = 'Current password is incorrect.';
      return;
    }
    // Update password in localStorage
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    const idx = students.findIndex(s => s.username === currentStudent.username);
    if (idx !== -1) {
      students[idx].password = newPass;
      localStorage.setItem('students', JSON.stringify(students));
      currentStudent.password = newPass;
      document.getElementById('changePassStatus').textContent = 'Password changed successfully!';
      setTimeout(() => {
        document.getElementById('changePassword').style.display = 'none';
      }, 1200);
    } else {
      document.getElementById('changePassStatus').textContent = 'Error updating password.';
    }
  });
</script>

</body>
</html>
